<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fuel for Life</title>
<style>
  body {
    margin: 0;
    font-family: 'Roboto', 'Segoe UI', sans-serif;
    background: #1e1e2f;
    height: 80vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
  }
  .game-container {
    width: 100%;
    max-width: 360px;
    height: 100%;
    max-height: 640px;
    background: #1e1e2f;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    padding: 8px;
    box-sizing: border-box;
    position: relative;
  }
  .top-bar { display: flex; justify-content: space-between; font-size: 16px; font-weight: 500; margin-bottom: 8px; }
  .metric { display: flex; align-items: center; gap: 4px; }
  .current-meal { text-align: center; font-size: 20px; font-weight: 600; margin-top: 8px; margin-bottom: 12px; color: #fff; }
  .meter-container { margin-bottom: 12px; }
  .meter-label { font-size: 13px; margin-bottom: 3px; color: #ccc; display: flex; align-items: center; gap:4px; }
  .meter { width: 100%; height: 18px; background: #333; border-radius: 8px; overflow: hidden; position: relative; }
  .meter-fill { height: 100%; width: 50%; transition: width 0.3s, background-color 0.3s; border-radius: 8px; position: absolute; left:0; top:0; }
  .meters-grid { display: flex; justify-content: space-between; margin-bottom: 15px; }
  .small-meter { width: 48%; }
  .meal-options { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }

  .meal-btn {
    padding: 12px;
    background: #2c2c3e;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    transition: 0.2s;
    color: #fff;
    text-align: center;
  }
  .meal-btn:hover { background: #3d3d55; transform: translateY(-2px); }
  .meal-emoji { font-size: 36px; margin-bottom: 4px; }
  .meal-title { font-weight: bold; margin-bottom: 4px; color: #ffcc00; font-size: 16px; }
.nutrients {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  margin-top: 5px;
  color: #bbb;
  width: 100%; /* take full width of the meal button */
}
.nutrients .left {
  text-align: left;
  margin-left: 16px; /* increase space from left edge */
}
.nutrients .extra {
  text-align: right;
  margin-right: 16px; /* increase space from left edge */
}

.big-emoji {
  font-size: 1.8em; /* adjust to taste */
  vertical-align: middle; /* keeps it aligned nicely with text */
}



  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: #fff;
    font-size: 18px;
    text-align: center;
    padding: 20px;
    display: none;
    z-index: 100;
  }
  .modal h2 { font-size: 24px; margin-bottom: 15px; color: #ff5555; }

  #game-over-btn {
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  background: #ffcc00;
  color: #1e1e2f;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
  margin-top: 52px; 
}

  #game-over-btn:hover { background: #ffd633; }

  .splash-screen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #1e1e2f;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    z-index: 10;
    color: #fff;
    font-size: 18px;
    text-align: center;
    padding: 20px;
  }
  .splash-screen h1 { font-size: 32px; color: #ffcc00; margin-bottom: 10px; }
  .splash-screen button {
    padding: 12px 24px;
    font-size: 18px;
    border-radius: 12px;
    border: none;
    background: #ffcc00;
    color: #1e1e2f;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }
  .splash-screen button:hover { background: #ffd633; }
  .splash-screen a { color: #ffd633; text-decoration: underline; cursor: pointer; font-size: 16px; }

  .instructions-screen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #1e1e2f;
    border-radius: 16px;
    z-index: 11;
    color: #fff;
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
    font-size: 14px;
  }
  .instructions-screen h2 { font-size: 26px; color: #ffcc00; margin-bottom: 10px; text-align: center; }
  .instructions-screen h3 { font-size: 18px; color: #ffd633; margin-top: 15px; margin-bottom: 5px; }
  .instructions-screen p { margin-bottom: 12px; line-height: 1.6; color: #ccc; }
  .instructions-screen ul { margin-left: 15px; line-height: 1.6; margin-bottom: 12px; }
  .instructions-screen li { margin-bottom: 6px; }
  .instructions-screen .back-btn {
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  background: #ffcc00;  /* Same as main buttons */
  color: #1e1e2f;       /* Same as main buttons */
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
  align-self: center;
  margin-top: 15px;
}

.instructions-screen .back-btn:hover {
  background: #ffd633;   /* Hover color like other buttons */
  transform: translateY(-2px);  /* Same hover lift effect as meals */
}

  .instructions-screen::-webkit-scrollbar { width: 8px; }
  .instructions-screen::-webkit-scrollbar-track { background: #1e1e2f; border-radius: 4px; }
  .instructions-screen::-webkit-scrollbar-thumb { background: #ffd633; border-radius: 4px; }
  .instructions-screen::-webkit-scrollbar-thumb:hover { background: #ffcc00; }


/* Current meal animations */
.scroll-in {
  animation: slideInRight 0.4s forwards;
}

.scroll-out {
  animation: slideOutLeft 0.4s forwards;
}


.current-meal-wrapper {
  width: 100%;
  overflow: hidden;  /* prevents scrollbars */
  text-align: center;
}


@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutLeft {
  from { transform: translateX(0); opacity: 1; }
  to   { transform: translateX(-100%); opacity: 0; }
}



#notification-modal {
  background: rgba(0,0,0,0.85);
}

#notification-title {
  font-size: 22px;
  color: #ffd633;
  margin-bottom: 10px;
}

#notification-btn {
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 12px;
  border: 2px solid #ffcc00;   /* yellow outline */
  background: transparent;     /* transparent background */
  color: #ffcc00;              /* yellow text */
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
  margin-top: 20px;
}

#notification-btn:hover {
  background: rgba(255, 204, 0, 0.15);  /* faint yellow tint */
  transform: translateY(-2px);          /* same hover lift */
}




  /* Hide main game UI initially */
  #game-ui { display: none; }
</style>
</head>
<body>

<div class="game-container">
  <audio id="gameover-sound" src="gameover.mp3"></audio>
  <audio id="happy-sound" src="happymeal.mp3"></audio>
  <audio id="sad-sound" src="sadmeal.mp3"></audio>

  <!-- Splash screen -->
  <div class="splash-screen" id="splash-screen">
    <h1>Fuel for Life</h1>
    <p>Balance your nutrients, keep your body healthy, and survive as long as you can!</p>
    <button onclick="startGame()">Start Game</button>
    <a onclick="showInstructions()">Instructions</a>
  </div>

  <!-- Instructions screen -->



 <div class="instructions-screen" id="instructions-screen" style="display:none;">
  <h1 style="font-size:32px; color:#ffcc00; margin-bottom:20px; text-align:center;">Fuel for Life</h1>
  <p style="font-size:16px; line-height:1.6; color:#ccc;">
    Welcome, foodaholic! Your mission is to thrive by carefully managing your <strong>nutrients</strong>, <strong>fullness</strong>, and <strong>pleasure</strong>, while keeping track of your üí∞ <em>resources</em>. Every meal choice matters. Plan strategically to survive as long as possible.
  </p>

  <h2 style="font-size:24px; color:#ffd633; margin-top:25px;">üìã Your Meters</h2>

  <p style="font-size:16px; line-height:1.5; color:#ccc;">
    <strong>üçΩÔ∏è Fullness:</strong> Represents how satiated you are. Too low, and you risk starvation. Too high, and repeated overeating can lead to food poisoning.<br><br>
    <strong>üòã Pleasure:</strong> Measures your satisfaction from meals. A low pleasure level affects motivation and can end your journey.<br><br>
    <strong>üçû Carbs:</strong> Your energy source. Overconsumption converts to <em>fat üßà</em>, while too little drains your energy.<br><br>
    <strong>üçó Protein:</strong> Essential for muscle and overall health. Depletion can lead to body breakdown.<br><br>
    <strong>üßà Fat:</strong> Necessary for energy storage, but excessive levels cause health collapse.<br><br>
    <strong>ü•¶ Vitamins:</strong> Required for general well-being. Deficiency can make you ill.<br><br>
    <strong>üí∞ Money:</strong> Essential for buying meals. Running out prevents you from eating and ends the game.
  </p>

  <h2 style="font-size:24px; color:#ffd633; margin-top:25px;">üçΩÔ∏è Meals</h2>

  <p style="font-size:16px; line-height:1.5; color:#ccc;">
    Meals affect your meters in different ways. Choose carefully to maintain balance and maximize survival:
  </p>

<p style="font-size:16px; line-height:1.5; color:#ccc;">
  <strong>ü•£ Oatmeal<br></strong> Boosts carbs üçû, protein üçó, and vitamins ü•¶. Moderate fullness, mild pleasure.<br><br>
  <strong>üçî Burger<br></strong> Increases carbs üçû, protein üçó, fat üßà, and pleasure üòã, but lowers vitamins ü•¶.<br><br>
  <strong>ü•ó Salad<br></strong> High in vitamins ü•¶ and fullness, reduces protein üçó and fat üßà, lower pleasure.<br><br>
  <strong>üçï Pizza<br></strong> Rich in carbs üçû and fat üßà, some protein üçó, high pleasure üòã.<br><br>
  <strong>üçó Grilled Chicken<br></strong> Protein üçó boost, moderate fat üßà, balanced fullness.<br><br>
  <strong>üçü Fries<br></strong> High carbs üçû and fat üßà, fun üòã, low protein üçó and vitamins ü•¶.<br><br>
  <strong>üçé/üçå Fruits<br></strong> Vitamins ü•¶, low fullness, lower pleasure.<br><br>
  <strong>ü•õ Yogurt<br></strong> Small boost to carbs üçû and protein üçó, minor pleasure.<br><br>
  <strong>üç´ Candy Bar / ü•§ Soft Drink<br></strong> Quick pleasure üòã, adds some carbs üçû, may reduce vitamins ü•¶ and protein üçó.<br><br>
  <strong>üçõ Butter Chicken<br></strong> High carbs üçû, protein üçó and fat üßà, strong fullness, moderate pleasure üòã, lower vitamins ü•¶.<br><br>
  <strong>üçπ Smoothie<br></strong> Boosts carbs üçû, vitamins ü•¶, and pleasure üòã, moderate fullness.<br><br>
  <strong>üç£ Sushi<br></strong> Balanced protein üçó, carbs üçû, and vitamins ü•¶, good fullness and pleasure üòã.<br><br>
  <strong>üç∞ Chocolate Cake<br></strong> High carbs üçû, fat üßà, and pleasure üòã, some protein üçó, lower vitamins ü•¶.<br><br>
  <strong>ü•ë Avocado Toast<br></strong> Good fats üßà, vitamins ü•¶, carbs üçû, moderate fullness, mild pleasure üòã.<br><br>
  <strong>ü•ìü•ö Eggs & Bacon<br></strong> High protein üçó and fat üßà, strong fullness, pleasure üòã, some vitamins ü•¶.<br><br>
  <strong>ü•ñ Granola Bar<br></strong> Moderate carbs üçû, protein üçó, and fat üßà, low fullness, some pleasure üòã.<br><br>
  <strong>üçÖ Tomato Soup<br></strong> Light carbs üçû and vitamins ü•¶, low fullness, mild pleasure üòã.<br><br>
  <strong>üç¶ Ice Cream<br></strong> High carbs üçû and fat üßà, fun üòã, moderate fullness, slight vitamin ü•¶ loss.<br><br>
  <strong>ü•ú Nuts Mix<br></strong> High protein üçó and fat üßà, moderate vitamins ü•¶, some fullness, enjoyable üòã.
</p>


  <h2 style="font-size:24px; color:#ffd633; margin-top:25px;">‚ö†Ô∏è Failure Conditions</h2>

  <p style="font-size:16px; line-height:1.5; color:#ccc;">
    <strong>Fullness extremes:</strong> Starvation or repeated overeating can end your journey.<br>
    <strong>Pleasure:</strong> Loss of enjoyment reduces motivation to continue.<br>
    <strong>Protein & Vitamins:</strong> Deficiency leads to physical breakdown or illness.<br>
    <strong>Fat:</strong> Excessive levels threaten overall health.<br>
    <strong>Money:</strong> Without sufficient funds, you cannot purchase meals and the game ends.
  </p>

  <h2 style="font-size:24px; color:#ffd633; margin-top:25px;">üí° Strategy Tips</h2>

  <p style="font-size:16px; line-height:1.5; color:#ccc;">
    Balance meals to maintain all meters within safe ranges. <br>Monitor your üí∞ resources carefully and plan around weekly allowances. <br>Rotate meals to avoid nutrient depletion, and remember: high pleasure foods üòã can be tempting but may unbalance fullness üßç‚Äç‚ôÇÔ∏è. <br>Always watch your meters, as neglecting any aspect can accelerate failure. <br>Plan your nutrition wisely, as excess carbs üçû automatically convert to fat üßà.
  </p>

  <p style="font-size:16px; line-height:1.5; color:#ccc; margin-top:20px;">
    Survive as long as possible, and see how many days you can thrive! Every choice matters.
  </p>

  <button class="back-btn" onclick="backToSplash()">Back</button>
</div>




  <!-- Main game UI -->
  <div id="game-ui">
    <div class="top-bar">
      <div class="metric" id="weight-display">üßçüèª‚Äç‚ôÇÔ∏è 140 lbs</div>
      <div class="metric" id="money-display">üí∞ $200</div>
    </div>

    <div class="meter-container">
      <div class="meter-label">üçΩÔ∏è Fullness</div>
      <div class="meter"><div class="meter-fill" id="fullness-fill"></div></div>
    </div>

    <div class="meter-container">
      <div class="meter-label">üòã Pleasure</div>
      <div class="meter"><div class="meter-fill" id="pleasure-fill"></div></div>
    </div>

    <div class="meters-grid">
      <div class="small-meter">
        <div class="meter-label">üçû Carbs</div>
        <div class="meter"><div class="meter-fill" id="carbs-fill"></div></div>
      </div>
      <div class="small-meter">
        <div class="meter-label">üçó Protein</div>
        <div class="meter"><div class="meter-fill" id="protein-fill"></div></div>
      </div>
    </div>

    <div class="meters-grid">
      <div class="small-meter">
        <div class="meter-label">üßà Fat</div>
        <div class="meter"><div class="meter-fill" id="fat-fill"></div></div>
      </div>
      <div class="small-meter">
        <div class="meter-label">ü•¶ Vitamins</div>
        <div class="meter"><div class="meter-fill" id="vit-fill"></div></div>
      </div>
    </div>

<div id="status-message" style="text-align:center; font-size:14px; margin:8px 0; color:#ffd633;">
  Stay balanced and keep eating smart!
</div>


    <div class="current-meal-wrapper">
  <div class="current-meal" id="current-meal">Day 1 - Breakfast</div>
</div>

    <div class="meal-options" id="meal-options"></div>
  </div>

<!-- Game Over Modal -->
<div class="modal" id="game-over-modal">
  <h2 id="game-over-msg">Game Over!</h2>
  <p id="days-survived"></p>
  <p id="high-score"></p>
  <button id="game-over-btn" onclick="backToMainMenu()">Back to Main Menu</button>
</div>

<!-- Notification Modal -->
<div class="modal" id="notification-modal">
  <h2 id="notification-title">Alert</h2>
  <p id="notification-msg"></p>
  <button id="notification-btn" onclick="closeNotification()">Dismiss</button>
</div>


<script>
const foodCatalog = [
  {name:"Oatmeal", emoji:"ü•£", effects:{carbs:8, protein:2, fat:1, vit:2, fullness:7, pleasure:-10}, nutrients:["carbs","protein","vit","fullness"], cost:10},
  {name:"Burger", emoji:"üçî", effects:{carbs:10, protein:5, fat:5, vit:-7, fullness:10, pleasure:10}, nutrients:["carbs","protein","fat","fullness","pleasure"], cost:15},
  {name:"Salad", emoji:"ü•ó", effects:{carbs:-8, protein:-4, fat:-13, vit:4, fullness:8, pleasure:-15}, nutrients:["vit","fullness"], cost:8},
  {name:"Pizza", emoji:"üçï", effects:{carbs:15, protein:1, fat:7, vit:-4, fullness:12, pleasure:12}, nutrients:["carbs","protein","fat","fullness","pleasure"], cost:17},
  {name:"Grilled Chicken", emoji:"üçó", effects:{carbs:-5, protein: 8, fat:3, vit:-4, fullness:9, pleasure: 5}, nutrients:["protein","fat","fullness"], cost:12},
  {name:"Fries", emoji:"üçü", effects:{carbs:12, protein:-10, fat:5, vit:-6, fullness:8, pleasure:10}, nutrients:["carbs","fat","fullness","pleasure"], cost:7},
  {name:"Apple", emoji:"üçé", effects:{carbs:8, protein:-3, fat:-5, vit:4, fullness:3, pleasure:-10}, nutrients:["carbs","vit"], cost:3},
  {name:"Banana", emoji:"üçå", effects:{carbs:7, protein:-3, fat:-4, vit:4, fullness:2, pleasure:-10}, nutrients:["carbs","vit"], cost:2},
  {name:"Yogurt", emoji:"ü•õ", effects:{carbs:5, protein:4, vit:4, fat:1, fullness:4, pleasure:3}, nutrients:["carbs","protein","vit"], cost:4},
  {name:"Candy Bar", emoji:"üç´", effects:{carbs:8, protein:-7, fat:3, vit:-3, fullness:5, pleasure:15}, nutrients:["carbs","fat","pleasure"], cost:3},
  {name:"Soft Drink", emoji:"ü•§", effects:{carbs:10, protein:-7, fat:0, vit:-2, fullness:2, pleasure:10}, nutrients:["carbs","pleasure"], cost:3},
  {name:"Butter Chicken", emoji:"üçõ", effects:{carbs:6, protein:15, fat:8, vit:-5, fullness:10, pleasure:10}, nutrients:["carbs", "protein","fat","fullness","pleasure"], cost:20},
  {name:"Smoothie", emoji:"üçπ", effects:{carbs:-5, protein: 2, fat:-7, vit:8, fullness: 4, pleasure:-8}, nutrients:["carbs","vit","pleasure"], cost:7},
  {name:"Sushi", emoji:"üç£", effects:{carbs:10, protein:8, fat:3, vit:3, fullness:8, pleasure:8}, nutrients:["carbs","protein","vit","fullness","pleasure"], cost:18},
  {name:"Chocolate Cake", emoji:"üç∞", effects:{carbs:20, protein:3, fat:12, vit:-3, fullness:3, pleasure:20}, nutrients:["carbs","protein","fat","pleasure"], cost:15},
  {name:"Avocado Toast", emoji:"ü•ë", effects:{carbs:8, protein:3, fat:2, vit:5, fullness:7, pleasure:7}, nutrients:["carbs","vit","fullness"], cost:10},
  {name:"Eggs & Bacon", emoji:"ü•ìü•ö", effects:{carbs:-6, protein:10, fat:12, vit:2, fullness:9, pleasure:10}, nutrients:["protein","fat","fullness","pleasure"], cost:14},
  {name:"Granola Bar", emoji:"ü•ñ", effects:{carbs:8, protein:7, fat:2, vit:2, fullness:3, pleasure:5}, nutrients:["carbs","protein"], cost:5},
  {name:"Tomato Soup", emoji:"üçÖ", effects:{carbs:6, protein:2, fat:-6, vit:5, fullness:3, pleasure:-5}, nutrients:["carbs","vit"], cost:6},
  {name:"Ice Cream", emoji:"üç¶", effects:{carbs:12, protein:1, fat:8, vit:-2, fullness:6, pleasure:15}, nutrients:["carbs","fat","fullness","pleasure"], cost:8},
  {name:"Nuts Mix", emoji:"ü•ú", effects:{carbs:2, protein:5, fat:10, vit:2, fullness:4, pleasure:7}, nutrients:["protein","fat","vit","fullness"], cost:9}
];

let fullness = 50, pleasure = 50, carbs = 50, protein = 50, fat = 25, vit = 50, money = 200;
let day = 1, mealsEaten = 0;
let consecutiveFullnessMax = 0;
let highScore = 0; // 
let hasStartedMeals = false; // controls animation after first meal
let lowMoneyWarned = false;
let gameOver = false;


const mealTitles = ["Breakfast","Lunch","Dinner"];

const mealSound = document.getElementById('meal-sound');
const happySound = document.getElementById('happy-sound');
const sadSound = document.getElementById('sad-sound');

const surpriseEvents = [
  {
    name: "Food Poisoning",
    effect: () => {
      fullness = 20;
      pleasure = 20;
      fat = Math.max(0, fat - 20);
      carbs = 10;
      vit = 30;
      protein = Math.max(0, protein - 10);
      showNotification(`
  That last meal didn‚Äôt sit well. You feel less satisfied with food for a while.<br><br>
  <span style="color:#f44336;">Fullness low</span><br>
  <span style="color:#f44336;">Pleasure low</span><br>
  <span style="color:#f44336;">Carbs low</span><br>
  <span style="color:#f44336;">Vitamins low</span><br>
`, "Food Poisoning! ü§¢");

    }
  },
  {
    name: "Flu",
    effect: () => {
      vit = 10;
      fullness = 20;
      pleasure = 20;
      fat = Math.max(0, fat - 10);
      carbs = 10;
      protein = Math.max(0, protein - 10);
      showNotification(`
        You caught the flu! You feel weak and less energized.<br><br>
        <span style="color:#f44336;">Vitamins low</span><br>
        <span style="color:#f44336;">Fullness low</span><br>
        <span style="color:#f44336;">Pleasure low</span><br>
        <span style="color:#f44336;">Carbs low</span><br>
      `, "Flu! ü§ß");
    }
  },
  {
    name: "Muscle Strain",
    effect: () => {
      protein = 20;
      showNotification(`
        Ouch! Your body feels weaker than usual, protein won‚Äôt be as effective today.<br><br>
        <span style="color:#f44336;">Protein low</span>
      `, "Muscle Strain! üí™");
    }
  }
];

let turnsSinceLastEvent = 0;
const minTurnsForEvent = 10; // Minimum meals before next event

function triggerDailyEvent() {
  if(turnsSinceLastEvent >= minTurnsForEvent) {
    const chance = 0.2; // 20% chance for a surprise event
    if(Math.random() < chance) {
      const event = surpriseEvents[Math.floor(Math.random() * surpriseEvents.length)];
      event.effect();
      turnsSinceLastEvent = 0;
    }
  }
}


function startGame() {
  document.getElementById('splash-screen').style.display = 'none';
  document.getElementById('instructions-screen').style.display = 'none';
  document.getElementById('game-ui').style.display = 'block';
  updateMeters();
  renderMeals();
}

function showInstructions() {
  document.getElementById('splash-screen').style.display = 'none';
  document.getElementById('instructions-screen').style.display = 'flex';
}

function backToSplash() {
  document.getElementById('instructions-screen').style.display = 'none';
  document.getElementById('splash-screen').style.display = 'flex';
}

function updateWeight() {
  const weight = 80 + (fat / 100) * (320 - 80);
  document.getElementById('weight-display').textContent = `üßçüèª‚Äç‚ôÇÔ∏è ${Math.round(weight)} lbs`;
}

function updateMeters() {
  function meterColor(value, type) {
  if (type === 'fullness') {
    if (value < 30) return '#f44336';      // Red if under 30
    if (value < 60) return '#ff9800';      // Orange if 30-59
    if (value <= 90) return '#4caf50';     // Green if 60-90
    return '#f44336';                      // Red if above 90
  } 
  else if (type === 'pleasure') {
    if (value < 30) return '#f44336';      // Red if under 30
    if (value < 60) return '#ff9800';      // Orange if 30-59
    return '#4caf50';                      // Green if 60+
  } 
  else if (type === 'carbs') {
    if (value < 25) return '#f44336';      // Red if under 25
    if (value < 54) return '#ff9800';      // Orange if 26-54
    if (value <= 75) return '#4caf50';     // Green if 60-75
    return '#f44336';                      // Red if above 90
  } 
  else if (type === 'fat') {
    if (value < 20) return '#f44336';      // Red if under 20
    if (value <= 50) return '#4caf50';     // Green if 20-50
    if (value <= 70) return '#ff9800';     // Orange if 51-90
    return '#f44336';                      // Red if above 90
  } 
  else if (type === 'protein' || type === 'vit') {
    if (value < 30) return '#f44336';
    if (value < 70) return '#ff9800';
    return '#4caf50';
  }
  return '#7c4dff'; // fallback color
}

  document.getElementById('fullness-fill').style.width = fullness + '%';
  document.getElementById('fullness-fill').style.backgroundColor = meterColor(fullness, 'fullness');
  document.getElementById('pleasure-fill').style.width = pleasure + '%';
  document.getElementById('pleasure-fill').style.backgroundColor = meterColor(pleasure, 'pleasure');
  document.getElementById('protein-fill').style.width = protein + '%';
  document.getElementById('protein-fill').style.backgroundColor = meterColor(protein, 'protein');
  document.getElementById('fat-fill').style.width = fat + '%';
  document.getElementById('fat-fill').style.backgroundColor = meterColor(fat, 'fat');
  document.getElementById('carbs-fill').style.width = carbs + '%';
  document.getElementById('carbs-fill').style.backgroundColor = meterColor(carbs, 'carbs');
  document.getElementById('vit-fill').style.width = vit + '%';
  document.getElementById('vit-fill').style.backgroundColor = meterColor(vit, 'vit');
  document.getElementById('money-display').textContent = `üí∞ $${money}`;
  updateWeight();

  updateStatusMessage();

}


function updateStatusMessage() {
  let message = "You're doing great, check back after next meal! <span class='big-emoji'>üòä</span>";

  if (fullness >= 90) {
    message = "üçΩÔ∏è Your stomach is getting too full, watch out! <span class='big-emoji'>üòß</span>";
  } else if (money < 20) {
    message = "üí∞ You‚Äôre nearly out of money! <span class='big-emoji'>üòß</span>";
  } else if (fullness <= 30) {
    message = "üçΩÔ∏è Your stomach‚Äôs almost empty! <span class='big-emoji'>üòß</span>";
  } else if (pleasure <= 30) {
    message = "üòî Food feels dull‚Ä¶ grab something tasty soon! <span class='big-emoji'>üòß</span>";
  } else if (protein <= 30) {
    message = "üçó Your protein is dangerously low. <span class='big-emoji'>üòß</span>";
  } else if (vit <= 30) {
    message = "ü•¶ You need vitamins, try fruits or veggies! <span class='big-emoji'>üòß</span>";
  } else if (fat >= 70) {
    message = "üßà Your fat levels are climbing too high! <span class='big-emoji'>üòß</span>";
  } else if (fat <= 20) {
    message = "üßà You are running low on healthy fats! <span class='big-emoji'>üòß</span>";
  } else if (money < 30) {
    message = "üí∞ You‚Äôre nearly out of money! <span class='big-emoji'>üòß</span>";
  } else if (carbs <= 25) {
    message = "üçû Your carbs is dangerously low. <span class='big-emoji'>üòß</span>";
  } else if (carbs >= 75) {
    message = "üçû Your carbs level is climbing! <span class='big-emoji'>üòß</span>";
  }
  

  document.getElementById("status-message").innerHTML = message;
}



function getRandomMeals() {
  const options = [];
  const usedIndices = [];
  while (options.length < 3) {
    const idx = Math.floor(Math.random() * foodCatalog.length);
    if (!usedIndices.includes(idx)) {
      usedIndices.push(idx);
      options.push(foodCatalog[idx]);
    }
  }
  return options;
}

function renderMeals() {
  const mealsDiv = document.getElementById('meal-options');
  mealsDiv.innerHTML = '';

  const options = getRandomMeals();
  const mealIndex = mealsEaten % 3;
const mealTitle = mealTitles[mealIndex];
const mealEmojis = ["‚õÖ", "‚òÄÔ∏è", "üåò"];
const mealEmoji = mealEmojis[mealIndex];
const currentMealEl = document.getElementById('current-meal');
const newText = `${mealEmoji} Day ${day} - ${mealTitle}`;

// Only animate after the first meal
if (hasStartedMeals && currentMealEl.textContent !== newText) {
  currentMealEl.classList.add("scroll-out");

  currentMealEl.addEventListener("animationend", function handler() {
    currentMealEl.textContent = newText;
    currentMealEl.classList.remove("scroll-out");
    currentMealEl.classList.add("scroll-in");

    currentMealEl.addEventListener("animationend", function cleanup() {
      currentMealEl.classList.remove("scroll-in");
      currentMealEl.removeEventListener("animationend", cleanup);
    });

    currentMealEl.removeEventListener("animationend", handler);
  });
} else {
  // On first render, just set text with no animation
  currentMealEl.textContent = newText;
}




  let affordable = false;

  options.forEach(food => {
    const btn = document.createElement('button');
    btn.className = 'meal-btn';

    const mainEmoji = food.emoji;

    const leftIcons = [];  // Main nutrients
    const rightIcons = []; // Fullness and Pleasure

    if(food.nutrients.includes("carbs")) leftIcons.push('üçû');
    if(food.nutrients.includes("protein")) leftIcons.push('üçó');
    if(food.nutrients.includes("fat")) leftIcons.push('üßà');
    if(food.nutrients.includes("vit")) leftIcons.push('ü•¶');
    if(food.nutrients.includes("fullness")) rightIcons.push('üçΩÔ∏è');
    if(food.nutrients.includes("pleasure")) rightIcons.push('üòã');

    btn.innerHTML = `
      <div class="meal-emoji">${mainEmoji}</div>
      <div class="meal-title">${food.name} <span class="cost">$${food.cost}</span></div>
      <div class="nutrients">
        <span class="left">${leftIcons.join(' ')}</span>
        <span class="extra">${rightIcons.join(' ')}</span>
      </div>
    `;

    if(money >= food.cost) {
      affordable = true;
      btn.onclick = () => eatMeal(food);
    } else {
      btn.disabled = true;
      btn.style.opacity = 0.5;
    }

    mealsDiv.appendChild(btn);
  });

  if(!affordable) showGameOver('money_zero');

}

function eatMeal(food) {
  if (food.effects.carbs) carbs += food.effects.carbs;
  if (food.effects.protein) protein += food.effects.protein;
  if (food.effects.fat) fat += food.effects.fat;
  if (food.effects.vit) vit += food.effects.vit;

  fullness += (food.effects.fullness-5)*1.5;
  pleasure += food.effects.pleasure;
  money -= food.cost;

  mealsEaten++;

  if(mealsEaten % 3 === 0) {
    day++;
    triggerDailyEvent();
  }

  turnsSinceLastEvent++;

  if(mealsEaten % 21 === 0) {
    money += 150;
    lowMoneyWarned = false; // ‚úÖ reset after allowance
    showNotification("You received your weekly allowance of $150!", "Cash Refilled üí∞");

  }

// Only warn once per cycle
const mealsLeftBeforeAllowance = 21 - (mealsEaten % 21);
const daysLeft = Math.ceil(mealsLeftBeforeAllowance / 3); // 3 meals per day

if (!lowMoneyWarned && money < 40 && mealsLeftBeforeAllowance > 3) {
  showNotification(
    `Spend carefully! Your next allowance arrives in ${daysLeft} day${daysLeft > 1 ? 's' : ''}. Budget carefully until then.`, "Short on Cash üí∞"
  );
  lowMoneyWarned = true;
}


  if(fullness >= 100) consecutiveFullnessMax++;
  else consecutiveFullnessMax = 0;

  clampValues();
  playChoiceSound();
  checkGameOver();
  updateMeters();

  hasStartedMeals = true;

  renderMeals();
}



function playChoiceSound() {
  function isRed(value, type) {
    if (type === 'fullness') return value < 30 || value > 90;
    if (type === 'pleasure') return value < 30;
    if (type === 'carbs') return value < 30 || value > 90;
    if (type === 'fat') return value < 20 || value > 90;
    if (type === 'protein' || type === 'vit') return value < 30;
    return false;
  }

  const anyRed = isRed(fullness, 'fullness') ||
                 isRed(pleasure, 'pleasure') ||
                 isRed(carbs, 'carbs') ||
                 isRed(protein, 'protein') ||
                 isRed(fat, 'fat') ||
                 isRed(vit, 'vit');

  if (anyRed) {
    sadSound.play();
  } else {
    happySound.play();
  }
}


function clampValues() {
  if(carbs > 100) {
    carbs = 50;
    fat = Math.min(100, fat + 4);
    if (!gameOver) {
      showNotification("üçû Too many carbs! Your body converted some into üßà fat.", "Carbs üçû ‚Üí Fat üßà");
    }


  }

  fullness = Math.min(100, Math.max(0, fullness));
  pleasure = Math.min(100, Math.max(0, pleasure));
  carbs = Math.min(100, Math.max(0, carbs));
  protein = Math.min(100, Math.max(0, protein));
  fat = Math.min(100, Math.max(0, fat));
  vit = Math.min(100, Math.max(0, vit));
  money = Math.max(0, money);
}

function checkGameOver() {
  if(fullness === 0) return showGameOver('fullness_zero');
  if(consecutiveFullnessMax >= 5) return showGameOver('fullness_overeat');
  if(fullness === 100 && consecutiveFullnessMax < 5) return showGameOver('fullness_max');
  if(pleasure === 0) return showGameOver('pleasure_zero');
  if(fat === 100) return showGameOver('fat_max');
  if(protein === 0) return showGameOver('protein_zero');
  if(vit === 0) return showGameOver('vit_zero');
  const affordable = foodCatalog.some(f => f.cost <= money);
  if(!affordable) return showGameOver('money_zero');
  if(fat === 0) return showGameOver('fat_zero');

}



function showGameOver(msgType) {
  
  if (gameOver) return; // ‚úÖ Prevent multiple triggers
  gameOver = true;

  document.getElementById('notification-modal').style.display = 'none';

const gameOverSound = document.getElementById('gameover-sound');
  gameOverSound.play(); 

  let msg = '';

  switch(msgType) {
    case 'fullness_zero':
      msg = `You ran out of energy and starved <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Try to keep your Fullness üçΩÔ∏è from dropping too low</span>`;
      break;
    case 'fullness_overeat':
      msg = `Your body couldn‚Äôt handle all that overeating <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Watch your Fullness üçΩÔ∏è and pace your meals</span>`;
      break;
    case 'fullness_max':
      msg = `That last meal was too much to handle ü§Æ<br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Keep an eye on your Fullness üçΩÔ∏è so you don‚Äôt max out</span>`;
      break;
    case 'pleasure_zero':
      msg = `Life felt too dull without tasty food üòû<br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Mix in a few fun meals to stay motivated</span>`;
      break;
    case 'fat_max':
      msg = `Your health gave out from too much Fat üßà <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Balance indulgent foods with lighter choices</span>`;
      break;
    case 'protein_zero':
      msg = `Your body weakened without enough Protein üçó <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Add more protein-rich meals to stay strong</span>`;
      break;
    case 'vit_zero':
      msg = `You got sick from a lack of Vitamins ü•¶ <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Don‚Äôt forget fruits and veggies to stay healthy</span>`;
      break;
    case 'money_zero':
      msg = `You ran out of cash üí∞ and couldn‚Äôt buy food <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Budget your meals so the money lasts longer</span>`;
      break;
    case 'fat_zero':
  msg = `You ran out of essential Fat üßà <br><span style="display:block; font-size:18px; color:#ccc; padding-top:20px;">Make sure to eat enough healthy fats to survive</span>`;
  break;

  }

  document.getElementById('game-over-msg').innerHTML = msg;

  document.getElementById('days-survived').innerHTML = 
    `You survived <strong>${day} day${day > 1 ? 's' : ''}</strong>`

  if(day > highScore) highScore = day;

  document.getElementById('high-score').innerHTML = 
    `üèÜ High Score: <strong>${highScore} day${highScore > 1 ? 's' : ''}</strong>`

  document.getElementById('game-over-modal').style.display = 'flex';
}





function backToMainMenu() {
  document.getElementById('game-over-modal').style.display = 'none';
  document.getElementById('splash-screen').style.display = 'flex';
  document.getElementById('game-ui').style.display = 'none';
  fullness = 50; pleasure = 50; carbs = 50; protein = 50; fat = 25; vit = 50; money = 200; // <-- changed
  day = 1; mealsEaten = 0; consecutiveFullnessMax = 0;
  gameOver = false; // ‚úÖ Reset flag here
  updateMeters();
}


function showNotification(msg, title = "Alert") {
  if (gameOver) return; // ‚úÖ Ignore notifications after game over
  document.getElementById('notification-msg').innerHTML = msg;
  document.getElementById('notification-title').textContent = title;
  document.getElementById('notification-modal').style.display = 'flex';
}


function closeNotification() {
  document.getElementById('notification-modal').style.display = 'none';
}


</script>

</body>
</html>
